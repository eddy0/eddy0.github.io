<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="node">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="node">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="node">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>node</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">node</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/27/expressNote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/27/expressNote/" itemprop="url">expressNote</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-27T15:15:43-07:00">
                2018-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/22/promise-and-async/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/promise-and-async/" itemprop="url">promise and async</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-22T00:42:34-07:00">
                2018-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h1><ul>
<li><p>Promise 构造函数包含一个参数和一个带有 resolve（解析）和 reject（拒绝）两个参数的回调。在回调中执行一些操作（例如异步），如果一切都正常，则调用 resolve，否则调用 reject。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// new Promise( resolve, reject ).then( success, erro )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do a thing, possibly async, then…</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* everything turned out fine */</span>) &#123;</span><br><span class="line">    resolve(<span class="string">"Stuff worked!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(<span class="built_in">Error</span>(<span class="string">"It broke"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// "Stuff worked!"</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err); <span class="comment">// Error: "It broke"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ajax 执行 promise</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do a thing, possibly async, then…</span></span><br><span class="line">  <span class="keyword">var</span> r = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  r.open(<span class="string">'GET'</span>, url)</span><br><span class="line">  r.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (r.status === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// Resolve the promise with the response text</span></span><br><span class="line">        resolve(r.response);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(<span class="built_in">Error</span>(r.statusText));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  r.send()</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Return a new promise.</span></span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle network errors</span></span><br><span class="line">    req.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject(<span class="built_in">Error</span>(<span class="string">"Network Error"</span>));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make the request</span></span><br><span class="line">    req.send();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>then 可以继续链式操作, 比如 <code>get(url).then().then().then()</code>.  </li>
<li>then() 只有一个参数的时候上一个结果表示成功的回调, 如果失败则不调用then(), 直接跳到 catch()</li>
<li>复杂的 catch 和 then 结合<ul>
<li>promise().then(fuc1).catch(fuc2) 上一个promise() 结果成功的时候调用 fuc1 , 如果失败时候进入 fuc2, 然后 fuc1 被拒绝的时候又调用 fuc2  </li>
<li>then(fuc1, fuc2).catch(error).then(good) 表示<ol>
<li>上一个结果成功时候调用fuc1， 然后 fuc1 成功的时候调用 good, 如果失败, 则进入error, 最后如果 error 成功则调用 good</li>
<li>上一个结果失败的时候调用 fuc2, 然后 fuc2 成功的时候直接调用 good, 如果失败, 则进入error, 最后如果 error 成功则调用 good</li>
</ol>
</li>
</ul>
</li>
<li>promise 的回调如果发生错误, 也会被拒绝直接进入 catch(error)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">asyncThing1().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> asyncThing2();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> asyncThing3();</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> asyncRecovery1();</span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> asyncThing4();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> asyncRecovery2();</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Don't worry about it"</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"All done!"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">执行 <span class="number">1</span>, 如果成功则进入 <span class="number">2</span>, 如果失败则进入 recovery <span class="number">1</span></span><br><span class="line">          <span class="number">2</span>: 成功则进入 <span class="number">3</span>  , 失败则进入 recovery <span class="number">1</span></span><br><span class="line">                <span class="number">3</span>: 成功则进入 <span class="number">4</span>,                         失败则进入 recovery <span class="number">1</span></span><br><span class="line">                    <span class="number">4</span>: 成功进入 all done, 失败进入 r2</span><br><span class="line">                                                             r1: 成功则进入 <span class="number">4</span>, 失败则进入 r2</span><br><span class="line">                                          r2 成功进入 all done, 失败进入 err</span><br><span class="line">                                                            进入all done</span><br></pre></td></tr></table></figure>
<h1 id="创建序列"><a href="#创建序列" class="headerlink" title="创建序列"></a>创建序列</h1><ul>
<li><p>Promise.resolve().then()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlArray.reduce( <span class="function">(<span class="params">sequence, url</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sequence.then( <span class="function"><span class="params">()</span> =&gt;</span> NextUrl(url) ).then( <span class="function">(<span class="params">content</span>) =&gt;</span> doSomething(content) )</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve() )</span><br></pre></td></tr></table></figure>
</li>
<li><p>Promise.all() — Promise.all 包含一组 promise，并创建一个在所有内容成功完成后执行的 promise。您将获得一组结果（即一组 promise 执行的结果），其顺序与与传入 promise 的顺序相同。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all(urls.map(getUrl)).then()</span><br></pre></td></tr></table></figure>
</li>
<li><p>边下载边显示 – 所有连接成功之后开始按顺序获取序列的内容, 获取一个就加载到页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Urls.map(getJSON)</span><br><span class="line">    .reduce(<span class="function"><span class="keyword">function</span>(<span class="params">sequence, chapterPromise</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> sequence.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> chapterPromise;</span><br><span class="line">      &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">chapter</span>) </span>&#123;</span><br><span class="line">        addHtmlToPage(chapter.html);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="built_in">Promise</span>.resolve());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h1><ul>
<li><code>*</code>号表示 generator， yield 是返回的位置<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">addGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    i += <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/22/promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/promise/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-22T00:41:29-07:00">
                2018-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/12/css禁止换行/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/12/css禁止换行/" itemprop="url">css禁止换行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-12T18:35:26-07:00">
                2018-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>overflow: hidden; /<em> 超出隐藏 </em>/<br>text-overflow: ellipsis; /<em> 文字省略号 </em>/<br>word-break: keep-all; /<em> 禁止文字中断 </em>/<br>white-space: nowrap; /<em> 空白不允许换行 </em>/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">overflow: hidden;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">word-break: keep-all;</span><br><span class="line">white-space: nowrap;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/30/node11-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/30/node11-1/" itemprop="url">node12</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-30T11:10:08-08:00">
                2018-01-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="csrf-跨站请求伪造-coress-site-request-forgery"><a href="#csrf-跨站请求伪造-coress-site-request-forgery" class="headerlink" title="csrf 跨站请求伪造 coress-site request forgery"></a>csrf 跨站请求伪造 coress-site request forgery</h1><ul>
<li>get 方案 img标签 不用点击就可以被攻击, 浏览器自动发 img src 请求</li>
<li><p>form 方案  用 script 的 click() 可以实现刷新自动点击提交</p>
</li>
<li><p>预防</p>
<ol>
<li>发请求的时候带一个一次性有效的随机值, 服务器收到之后比对一下</li>
<li>验证码来预防 csrf</li>
</ol>
</li>
<li>原理<ul>
<li>get 的 index 里面生成随机值作为 token, 然后把 csrfToken[token] = u.id</li>
<li>在 a 标签里面加上 ？token=</li>
<li>删除操作里面拿到 token, 并且一致性判断, token in csrfToken &amp;&amp; csrfToken[token] === u.id , 成功则删掉这个的token, <code>delete csrfToken[token]</code>, 这个实现一次性.</li>
</ul>
</li>
</ul>
<h1 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h1><p> 在文本里面发 js 信息,<br> nunjucks 默认打开 xss, 把 符号 转义, 不执行代码.</p>
<ol>
<li>转义</li>
<li>保护好 cookie</li>
</ol>
<h1 id="express-的中间件"><a href="#express-的中间件" class="headerlink" title="express 的中间件"></a>express 的中间件</h1><h1 id="pm2-守护进程-防止程序出错"><a href="#pm2-守护进程-防止程序出错" class="headerlink" title="pm2 守护进程, 防止程序出错"></a>pm2 守护进程, 防止程序出错</h1><ul>
<li>查看 log 信息<br>cd ~/.pm2/logs</li>
</ul>
<p>、、</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/25/node11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/25/node11/" itemprop="url">node11</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-25T15:47:19-08:00">
                2018-01-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>url(../node/node11)</p>
<h1 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h1><ul>
<li>用 || 来判断的时候, 数值类型一定要对应</li>
<li>loginRequired<br>在需要登录的操作加上 loginRequired, 这个情况下 request.method 有可能是 post, 也有可能是 get.</li>
<li>需不需要跳转页面可以用 <base_url>url=<next_url> , 这里 next_url 的 path 可以写在 form 表单里面得到.</next_url></base_url></li>
<li><p>api 传输数据标准</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r.sucess?r.data : r.message</span><br><span class="line">dict = &#123;</span><br><span class="line">    success: true,</span><br><span class="line">    data: data,</span><br><span class="line">    message:&apos;&apos;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>http 模块的 protocol 是 ‘http:’</p>
</li>
<li>配置环境变量 process.env 查看环境变量, 也可以设置环境变量</li>
</ul>
<h1 id="express-技术"><a href="#express-技术" class="headerlink" title="express 技术"></a>express 技术</h1><ul>
<li>app.use((request, response) =&gt; {})</li>
</ul>
<h1 id="package-json-scriptes"><a href="#package-json-scriptes" class="headerlink" title="package.json scriptes"></a>package.json scriptes</h1><p>思考: 是否可以通过 fs.watch 来实现保存自动刷新页面</p>
<ul>
<li>yarn run dev  监听项目变化, 自动重启<br>dev: nodemon app.js</li>
<li>yarn run start<br>start: om2 start app.js</li>
</ul>
<h1 id="nunjucks"><a href="#nunjucks" class="headerlink" title="nunjucks"></a>nunjucks</h1><ul>
<li>管道<br>上一个的输出作为下一个的输入</li>
</ul>
<h1 id="node-循环依赖的问题的解决"><a href="#node-循环依赖的问题的解决" class="headerlink" title="node 循环依赖的问题的解决"></a>node 循环依赖的问题的解决</h1><p>在要使用的函数里面 require 其他文件的函数</p>
<h1 id="linux-修改权限"><a href="#linux-修改权限" class="headerlink" title="linux 修改权限"></a>linux 修改权限</h1><ul>
<li>更改用户组<br>sudo chown -R ubuntu:ubuntu /home/ubuntu</li>
<li>修改用户组权限<br>chmode -R g-rwx /home/ubuntu/.ssh<br>chmode -R o-rwx /home/ubuntu/.ssh</li>
<li>复制文件到 root<br>cp /home/ubuntu/.ssh/authorized_keys  /root/.ssh/authorized_keys</li>
<li>如果显示permission denied 就加 sudo</li>
<li>也可以给用户规定权限写死 不让使用 sudo</li>
</ul>
<h1 id="api-的形式传输数据"><a href="#api-的形式传输数据" class="headerlink" title="api 的形式传输数据"></a>api 的形式传输数据</h1><ul>
<li>减少数据量, 加快响应速度</li>
<li>更加自由</li>
</ul>
<h1 id="前端两种处理报错的方式"><a href="#前端两种处理报错的方式" class="headerlink" title="前端两种处理报错的方式"></a>前端两种处理报错的方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1. ajax(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    method: method,</span><br><span class="line">    data: data,</span><br><span class="line">    success: function(r)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">    error: function(e)&#123;</span><br><span class="line">            // 406</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">2. 第二种推荐</span><br><span class="line">    sucess: if (r.success)&#123;</span><br><span class="line">                sucessResponse(r.data)</span><br><span class="line">             &#125; else&#123;</span><br><span class="line">                errorResponse(r.message)</span><br><span class="line">             &#125;</span><br><span class="line">    error: function(e)&#123;</span><br><span class="line">            // globalErrorResponse</span><br><span class="line">            var r = &#123;</span><br><span class="line">                success: false,</span><br><span class="line">                data: null,</span><br><span class="line">                message: &apos;error&apos;</span><br><span class="line">            &#125;</span><br><span class="line">            globalErrorResponse(r)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><ul>
<li>标志报错信息: No ‘access-control-allow-origin’</li>
<li>端口不一样就会跨域, protocol, host, port</li>
<li>jonsp 也要后端配合, 只能处理 get 方式的请求</li>
<li>解决方式 cors<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node 配置 cors, 就直接可以配置 cors了</span><br><span class="line">const cors = require(&apos;cors&apos;)</span><br><span class="line">app.use(cors())</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h1><p>这里只的是开发环境上的分离</p>
<ol>
<li>普通开发模式<br>前端写客户端, 后端写 api 服务端</li>
</ol>
<ul>
<li><p>问题:</p>
<ul>
<li>前端需要搭建后端的开发环境, 然后运行后端的项目, 瘸腿.</li>
<li>前后端对接的时候后端改动一个地方, 前端可能需要更新项目代码, git pull 之后发现需要更新更多的代码</li>
</ul>
</li>
<li><p>另外一种方式: 前后端在两个环境里面, 后端设置好 cors 解决跨域的问题</p>
</li>
</ul>
<ol>
<li>前后端分离</li>
</ol>
<ul>
<li><p>办法:</p>
<ul>
<li>用 node 做转发服务器,</li>
<li>通过配置 nginx 的方式在实现分离</li>
</ul>
</li>
<li><p>流程:</p>
<ul>
<li>node 把请求发送到 api server, api server 处理好请求并且返回响应</li>
<li>node 接受 api server 返回的响应, 并且把这个响应发送到浏览器端</li>
<li>浏览器接受响应, 渲染页面</li>
</ul>
</li>
</ul>
<h1 id="前端自己开发环境-独立配置-bridge"><a href="#前端自己开发环境-独立配置-bridge" class="headerlink" title="前端自己开发环境, 独立配置, bridge"></a>前端自己开发环境, 独立配置, bridge</h1><p>作用: 原样模拟客户端的请求发送到服务器<br>用node 使用 http 模块,<br>express 和 nunjuncks 相互使用<br>不管发什么请求, 都有一些基本的配置项 apiOptions<br>app.all 可以匹配 api 下面的所有请求 app.all(/api/*)  </p>
<p>//</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/24/node10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/24/node10/" itemprop="url">node10</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-24T07:08:35-08:00">
                2018-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="技巧和理论"><a href="#技巧和理论" class="headerlink" title="技巧和理论"></a>技巧和理论</h1><ul>
<li>写 WEB 实际上是在操作字符串, 比如写请求头, 请求的格式, 版本, Path, query, body 这些, web 的发展从 C, perl, php, java, ror (ruby on rails), python, node( JavaScript) express/koa</li>
<li>禁止使用正则表达式, 可读性非常差</li>
<li>学的时候资料很丰富, 比较活跃, koa 把异步的封装的比较好, 但是我自己处理这块也没有什么问题, 如果要上手的话, 看下文档也可以写.</li>
<li>host ‘0.0.0.0’,  让别人也可以访问你的电脑</li>
</ul>
<ul>
<li><p>路由按功能划分, todo 就是 todo 的路由</p>
</li>
<li><p>debug 难点: 并不知道程序运行的状态, 程序运行到哪里, 用 log, 把变量值 log 出来, 在循环里面 log</p>
</li>
<li><p>动态路由的好处是路由非常简洁</p>
</li>
</ul>
<h1 id="niginx-安装"><a href="#niginx-安装" class="headerlink" title="niginx 安装"></a>niginx 安装</h1><p>重启 nginx<br><code>service nginx restart</code></p>
<p>运行程序<br><code>yarn run start</code></p>
<p>安装 pm2<br><code>yarn global add pm2</code></p>
<p>pm2 日志<br><code>$HOME/.pm2/logs</code> 文件夹会包含所有应用的日志</p>
<p>实时日志命令<br><code>pm2 logs</code></p>
<p>// ===<br>// 服务器中文编码问题<br>// ===<br>//<br>// 编辑下面的文件, 不要拼错<br>nano /etc/environment<br>// 加入下面的内容, 保存退出<br>LC_CTYPE=”en_US.UTF-8”<br>LC_ALL=”en_US.UTF-8”<br>*/</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/23/node9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/23/node9/" itemprop="url">node9</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-23T10:49:41-08:00">
                2018-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#连接服务器<br>ssh root@108.61.214.98</p>
<p>终端: 可以运行不同的Shell(壳), shell 去运行操作系统内核的命令</p>
<ul>
<li><p>pwd</p>
<ul>
<li>救命命令, 看自己在哪个目录</li>
<li>print working dir</li>
<li>显示现在所处的目录</li>
</ul>
</li>
<li><p>echo $PATH</p>
<ul>
<li>环境变量, 当输入一个命令, 系统会去 $PATH 里面找, 如果在其中是目录里面, 就可以执行输入的命令</li>
<li>用冒号分隔</li>
</ul>
</li>
<li><p>ls</p>
<ul>
<li>不带参数就显示当前目录下的所有文件</li>
<li>程序可以加参数</li>
<li>ls / 显示根目录</li>
<li><code>-l</code> 显示详细信息</li>
<li><code>-h</code> 人性化显示文件尺寸</li>
<li><code>-a</code> 显示所有文件， 以 . 开头的文件是隐藏文件</li>
<li>还可以带一个目录当参数，这样就会显示这个目录</li>
<li>下面两个是等价的<ul>
<li><code>ls -l -h</code></li>
<li><code>ls -lh</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>cd</p>
<ul>
<li>cd Desktop</li>
<li>改变当前目录 change directory</li>
<li>. 代表当前目录</li>
<li>.. 代表上级目录</li>
<li>cd 不带参数就回到默认的家目录  cd</li>
<li>每个用户都有一个家目录，默认在 <code>/home/用户名</code></li>
<li>root 用户的家目录是 <code>/root</code></li>
</ul>
</li>
<li><p>touch</p>
<ul>
<li><code>touch a.gua</code></li>
<li>如果 a.gua 存在就更新修改时间</li>
<li>如果 a.gua 不存在就创建文件</li>
</ul>
</li>
<li><p>mkdir</p>
<ul>
<li>创建一个目录</li>
<li><code>-p</code> 可以一次性创建多层目录</li>
<li><code>mkdir -p a/b/c</code></li>
</ul>
</li>
</ul>
<ul>
<li><p>cp</p>
<ul>
<li>复制出一个文件，用法如下</li>
<li><code>cp a.txt b.txt</code></li>
<li>复制 a.txt 并把新文件取名为 b.txt</li>
<li>复制目录要加上 -r 参数</li>
<li><code>cp -r a b</code></li>
</ul>
</li>
<li><p>rmdir</p>
<ul>
<li>只能用来删除一个空目录</li>
</ul>
</li>
<li><p>rm</p>
<ul>
<li>这个命令直接删除东西，很危险，一般不要用</li>
<li>删除文件或者目录</li>
<li><code>-f</code> 强制删除</li>
<li><code>-r</code> 用来删除目录</li>
</ul>
</li>
<li><p>mv</p>
<ul>
<li>移动文件或者文件夹</li>
<li>也可以用来改名</li>
<li><code>mv a.txt b.txt</code></li>
<li><code>mv b.txt ../</code></li>
<li><code>mv b.txt ../gua.txt</code></li>
<li>可以用 <code>mv xx /tmp</code> 的方式来将文件放入临时文件夹</li>
<li>tmp是操作系统提供的临时文件夹，重启会删除里面的所有文件</li>
</ul>
</li>
<li><p>cat</p>
<ul>
<li>显示文件内容</li>
</ul>
</li>
<li>tac<ul>
<li>反过来显示文件内容</li>
</ul>
</li>
<li><p>nl</p>
<ul>
<li>显示内容并附带行号</li>
</ul>
</li>
<li><p>more less head tail</p>
<ul>
<li>more 可以分屏分批看文件内容</li>
<li>less 比 more 更高级，可以前后退看文件 q 退出</li>
<li>head 可以显示文件的前 10 行</li>
<li>tail 可以显示文件的后 10 行</li>
<li>head 和 tail 有一个 -n 参数</li>
<li><code>head -n 20 a.gua</code></li>
</ul>
</li>
</ul>
<h2 id="目录分布"><a href="#目录分布" class="headerlink" title="目录分布"></a>目录分布</h2><p>主要如下：</p>
<ul>
<li><code>/home</code> 家目录</li>
<li><code>/root</code> root 用户目录</li>
<li><code>/etc</code> 放配置文件</li>
<li><code>/tmp</code> 临时文件</li>
<li><code>/var/log</code> 日志</li>
<li><code>/bin</code> binary 命令存放的地方。有好几个 bin，不用理解。</li>
<li><code>/lib</code> library 库</li>
</ul>
<h2 id="权限操作"><a href="#权限操作" class="headerlink" title="权限操作"></a>权限操作</h2><ul>
<li>sudo<ul>
<li>用管理员帐户执行程序</li>
<li>比如安装程序或者修改一些系统配置都需要管理员权限</li>
</ul>
</li>
<li>su<ul>
<li>switch user， 切换用户</li>
<li><code>su root</code> 为了方便操作, 统一选择 root 用户, 也就是说如果你不是用 root 登录，先切换到 root 用户</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件权限    文件类型 用户 用户组 文件大小  修改日期     文件名</span><br><span class="line">-rw-rw-r--  1       gua gua     10      11/09 20:28 b.gua</span><br><span class="line">drwxrwxr-x  2       gua gua     4096    11/09 20:28 tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件类型    是否可读  是否可写  是否可执行</span><br><span class="line">d           r       w           x</span><br><span class="line">-           r       w           x</span><br></pre></td></tr></table></figure>
<ul>
<li>三组 rwx 分表代表 所属用户|同组用户|其他用户</li>
<li>rwx 可以用数字表示为 421</li>
<li>于是乎<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r-- 就是 4</span><br><span class="line">rw- 就是 6</span><br><span class="line">rwx 就是 7</span><br><span class="line">r-x 就是 5</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r--     文件的访问权限</span><br><span class="line">1              文件的链接数目(这个不用关心)</span><br><span class="line">root           文件所有者的用户名</span><br><span class="line">root           文件所属用户组</span><br><span class="line">10             文件大小（单位是字节）</span><br><span class="line">11/09 20:28    上次修改文件的日期和时间</span><br><span class="line">b.gua          文件名</span><br></pre></td></tr></table></figure>
<ul>
<li>chown<ul>
<li>改变文件的用户</li>
<li><code>chown gua c.gua</code></li>
<li><code>chown gua:gua c.gua</code></li>
</ul>
</li>
<li>chmod<ul>
<li>改变文件权限，不要用数字</li>
<li><code>chmod 666 root.gua</code></li>
<li><code>chmod +x root.gua</code></li>
<li><code>chmod -x tmp</code></li>
<li>修改所属用户权限 <code>chmod u+x tmp</code></li>
<li>修改同组用户权限 <code>chmod g+x tmp</code></li>
<li>修改其他用户权限 <code>chmod o+x tmp</code></li>
</ul>
</li>
</ul>
<p>drwxr—– 2 root   root 4.0K Jan 22 16:02 data</p>
<h2 id="信息查找"><a href="#信息查找" class="headerlink" title="信息查找"></a>信息查找</h2><ul>
<li>file<ul>
<li>显示文件的类型（不是百分之百准确）</li>
</ul>
</li>
<li>uname<ul>
<li>显示操作系统的名字或者其他信息</li>
<li><code>uname -r</code></li>
<li><code>uname -a</code></li>
</ul>
</li>
<li>which<ul>
<li><code>which pwd</code></li>
<li>显示 pwd 的具体路径</li>
</ul>
</li>
<li>whereis<ul>
<li><code>whereis ls</code></li>
<li>显示更全面的信息</li>
</ul>
</li>
<li>whoami</li>
<li><code>find . -name &quot;&quot;</code></li>
</ul>
<h2 id="奇怪符号"><a href="#奇怪符号" class="headerlink" title="奇怪符号"></a>奇怪符号</h2><p>~   家目录快捷方式</p>
<blockquote>
<p>  覆盖式重定向</p>
<blockquote>
<p> 追加重定向<br>|   管道, history | gerp a  在 history 里面找 a 这个命令， 在 | 之前的 做什么事情<br><code>`  获取命令执行的结果
比如 echo pwd 输出的就是 pwd 这个字符串
echo</code>pwd` 输出的是 pwd 命令执行的结果, 相当于一个变量</p>
</blockquote>
</blockquote>
<p>&amp;   后台执行<br>    node server.js &amp;<br>    可以用 fg 命令把一个在后台的程序拉到前台来<br>    可以用 Ctrl-z 来把一个前台的程序放到后台去挂起<br>()  开新的子进程shell执行 (不用掌握这一条, 因为几乎没人用)</p>
<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><ul>
<li>history<ul>
<li>查看历史命令</li>
</ul>
</li>
<li>grep<ul>
<li>查找</li>
</ul>
</li>
<li>这两个一般配合使用<ul>
<li><code>history | grep touch</code></li>
</ul>
</li>
<li>C-r 搜索上一条命令</li>
<li><p>ps</p>
<ul>
<li>查看进程, 一般用下面的用法</li>
<li><code>ps ax</code></li>
<li><code>ps ax | grep node</code></li>
<li>查看带 node 字符串的进程</li>
</ul>
</li>
<li><p>kill 和 killall 杀进程</p>
<ul>
<li>用 <code>ps ax</code> 找到进程id (pid)</li>
<li>普通杀： <code>kill [pid]</code> / <code>kill -15 [pid]</code> / <code>kill -TERM [pid]</code></li>
<li>强制杀： <code>kill -9 [pid]</code> / <code>kill -KILL [pid]</code></li>
<li>先用 <code>kill</code> 再用 <code>kill -KILL</code>，不要用带数字的</li>
<li>killall 是用进程名字来杀进程</li>
</ul>
</li>
<li><p>后台前台</p>
<ul>
<li>fg</li>
<li>jobs</li>
</ul>
</li>
<li><p>快捷键</p>
<ul>
<li>C-z 挂起到后台</li>
<li>C-c C-d 中断程序</li>
</ul>
</li>
<li><p>reboot</p>
<ul>
<li>重启</li>
</ul>
</li>
<li>shutdown<ul>
<li>关机</li>
<li>可以用参数指定时间</li>
</ul>
</li>
<li>halt<ul>
<li>关机</li>
</ul>
</li>
</ul>
<h2 id="ssh-key-的概念和使用"><a href="#ssh-key-的概念和使用" class="headerlink" title="ssh-key 的概念和使用"></a>ssh-key 的概念和使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 1. 生成 ssh id_rsa.pub</span><br><span class="line">ssh-keygen</span><br><span class="line">Mac 用户直接打开终端输入命令</span><br><span class="line">Win 打开 cmder 程序, 在里面输入下面的命令</span><br><span class="line"></span><br><span class="line">1. 在本机生成 ssh key 公钥私钥</span><br><span class="line">注意 下面的 mykey 随便换一个你喜欢的名字, 这是一个标注, 方便你看的</span><br><span class="line">ssh-keygen -C &lt;mykey&gt;</span><br><span class="line">会提示你生成的文件的地址, 并且让你输入密码, 你不要输入密码, 直接回车</span><br><span class="line"></span><br><span class="line">这样你就得到了一对 ssh-key, 这是用于登录服务器用的</span><br><span class="line">默认你会得到两个文件</span><br><span class="line">id_rsa 是私钥 自己保存 不要给别人看</span><br><span class="line">id_rsa.pub 是公钥, 是要到处使用的</span><br><span class="line">这个是我们之前提到的非对称加密</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 2. 普通用户把 public key 添加到 ~/.ssh/authorized_keys</span><br><span class="line">##  root用户把 public key 添加到 /root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"># 3. 重启 ssh</span><br><span class="line">service ssh restart</span><br></pre></td></tr></table></figure>
<h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p><code>apt-get install 软件名</code><br>比如下面<br><code>apt-get install ufw</code></p>
<h2 id="安装防火墙-和-防火墙的基本套路配置"><a href="#安装防火墙-和-防火墙的基本套路配置" class="headerlink" title="安装防火墙 和 防火墙的基本套路配置"></a>安装防火墙 和 防火墙的基本套路配置</h2><ul>
<li>防火墙的作用(redis安全漏洞)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ufw</span><br><span class="line">ufw allow 22</span><br><span class="line">ufw allow 80</span><br><span class="line">ufw allow 443</span><br><span class="line">ufw default deny incoming</span><br><span class="line">ufw default allow outgoing</span><br><span class="line">ufw status verbose</span><br><span class="line">ufw enable</span><br></pre></td></tr></table></figure>
<h2 id="Shell-设置"><a href="#Shell-设置" class="headerlink" title="Shell 设置"></a>Shell 设置</h2><ol>
<li>装 zsh <code>sudo apt-get install zsh</code></li>
<li>装 oh-my-zsh<br><code>wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</code></li>
</ol>
<p>部署项目</p>
<h1 id="软件安装-1"><a href="#软件安装-1" class="headerlink" title="软件安装"></a>软件安装</h1><p>安装 git nginx<br><code>apt-get install git nginx</code></p>
<p>ubuntu 的软件仓库中的 nodejs 更新很慢, 几乎可以认为不可用,<br>所以我们从 nodeSource 仓库中安装新款 nodejs</p>
<p>配置 nodeSource 仓库<br><code>curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash -</code></p>
<p>配置之后就可以安装最新的 nodejs<br><code>sudo apt-get install -y nodejs</code></p>
<p>安装 yarn<br><code>npm install yarn -g</code></p>
<p>安装依赖<br><code>yarn install</code></p>
<p>配置 nginx<br><code>ln -s /var/www/weibo/weibo.nginx /etc/nginx/sites-enabled/weibo</code></p>
<p>列出 nginx/sites-enabled 下面的文件<br><code>root@linlab:~# ls -l /etc/nginx/sites-enabled/</code></p>
<p>第一个字母是 l, 这个表示 weibo 是一个软链接, 当访问 weibo 时,<br>实际上访问的是 /var/www/weibo/weibo.nginx<br>这样做的好处是我们只需要更新 weibo.nginx 就可以<br>软链接类似 windows 下的快捷方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx 1 root root 26 May 23 14:09 weibo -&gt; /var/www/weibo/weibo.nginx</span><br></pre></td></tr></table></figure></p>
<p>移除默认的配置文件<br><code>mv /etc/nginx/sites-enabled/default /tmp</code><br><code>mv /etc/nginx/sites-available/default /tmp</code></p>
<p>重启 nginx<br><code>service nginx restart</code></p>
<p>运行程序<br><code>yarn run start</code></p>
<p>安装 pm2<br><code>yarn global add pm2</code></p>
<p>pm2 日志<br><code>$HOME/.pm2/logs</code> 文件夹会包含所有应用的日志</p>
<p>实时日志命令<br><code>pm2 logs</code></p>
<p>// ===<br>// 服务器中文编码问题<br>// ===<br>//<br>// 编辑下面的文件, 不要拼错<br>nano /etc/environment<br>// 加入下面的内容, 保存退出<br>LC_CTYPE=”en_US.UTF-8”<br>LC_ALL=”en_US.UTF-8”<br>*/</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/21/node8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/21/node8/" itemprop="url">node8</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-21T21:52:57-08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="web-框架"><a href="#web-框架" class="headerlink" title="web 框架"></a>web 框架</h1><p>cookie 和 session, 加密, 模板</p>
<h1 id="数据库为什么这么快"><a href="#数据库为什么这么快" class="headerlink" title="数据库为什么这么快"></a>数据库为什么这么快</h1><p>不同的数据结构来存储数据, 对数据的操作花的时间不一样<br>数据库用了更快的数据结构来操作数据, 来保证 CRUD 更快更方便<br>数据库是最早计算机发展的原动力, 比如电影, 游戏需要计算机图形学, 需要更快的数据.<br>当数据量大的时候, 数据库的速度就很明显了</p>
<h1 id="sql-数据库和-nosql-数据库的区别"><a href="#sql-数据库和-nosql-数据库的区别" class="headerlink" title="sql 数据库和 nosql 数据库的区别"></a>sql 数据库和 nosql 数据库的区别</h1><p>sql 是 关系型数据库, 给大型企业用的, 追求稳定, 但是成本高, 结构要求一致, 以表的形式存储数据<br>NoSQL no only sql, 一个新式的数据库, 速度更快,<br>better-sqlite3: 同步， 嵌入式开发使用</p>
<p>数据库通过 SQL 来操作数据<br>SQL （结构化查询语言）<br>操作数据库的接口 也就是操作数据库的方法</p>
<ul>
<li>增加数据</li>
<li>删除数据</li>
<li>修改数据</li>
<li>查询数据</li>
<li>CRUD create retrieve update delete</li>
</ul>
<h1 id="MEAN-技术栈-mongo-express-react-node"><a href="#MEAN-技术栈-mongo-express-react-node" class="headerlink" title="MEAN 技术栈 = mongo + express + react + node"></a>MEAN 技术栈 = mongo + express + react + node</h1><h1 id="JS-防止注入-—-用转义"><a href="#JS-防止注入-—-用转义" class="headerlink" title="JS 防止注入 — 用转义"></a>JS 防止注入 — 用转义</h1><h1 id="sqlite"><a href="#sqlite" class="headerlink" title="sqlite"></a>sqlite</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">const Database = require(&apos;better-sqlite3&apos;)</span><br><span class="line"></span><br><span class="line">// 创建一个表</span><br><span class="line">const create = (db) =&gt; &#123;</span><br><span class="line">    const sqlCreate = `</span><br><span class="line">    CREATE TABLE user (</span><br><span class="line">        id INTERGER NOT NULL PRMARY KEY AUTOINCREMENT,</span><br><span class="line">        username  TEXT NOT NULL UNIQUE,</span><br><span class="line">        password  TEXT NOT NULL,</span><br><span class="line">        email     TEXT</span><br><span class="line">        )</span><br><span class="line">    `</span><br><span class="line"></span><br><span class="line">    const statement = db.prepare(sqlCreate)</span><br><span class="line">    const info = statement.run()</span><br><span class="line">&#125;</span><br><span class="line">// 插入数据</span><br><span class="line">const insert = (db, username, password, email) =&gt; &#123;</span><br><span class="line">    const sqlInsert = `</span><br><span class="line">    INSERT INTO</span><br><span class="line">        users(username, password, email)</span><br><span class="line">    VALUES</span><br><span class="line">        (?,?,?)</span><br><span class="line">    `</span><br><span class="line">    const statement = db.prepare(sqlInsert)</span><br><span class="line">    const args = [username, password, email]</span><br><span class="line">    const info = statement.run(args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询数据</span><br><span class="line">const select = (db,id) =&gt; &#123;</span><br><span class="line">    const sqlQuery = `</span><br><span class="line">    SELECT</span><br><span class="line">        *</span><br><span class="line">    FROM</span><br><span class="line">        users</span><br><span class="line">    WHERE</span><br><span class="line">        id=?</span><br><span class="line">    `</span><br><span class="line">    const statement = db.prepare(sqlQuery)</span><br><span class="line">    // 查一条</span><br><span class="line">    const row = statement.get()</span><br><span class="line">    // 查多条</span><br><span class="line">    const rows = statement.all()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除数据</span><br><span class="line">const del = (db, user_id) =&gt; &#123;</span><br><span class="line">    const sqlDelete = `</span><br><span class="line">    DELETE FROM</span><br><span class="line">        users</span><br><span class="line">    WHERE</span><br><span class="line">        id = ?</span><br><span class="line">    `</span><br><span class="line">    const statement = db.prepare(sqlDelete)</span><br><span class="line">    statement.run(userId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//更新数据</span><br><span class="line">const update = (db, user_id, email) =&gt; &#123;</span><br><span class="line">    const sqlUpdate = `</span><br><span class="line">    UPDATE</span><br><span class="line">        users</span><br><span class="line">    SET</span><br><span class="line">        email=?</span><br><span class="line">    WHERE</span><br><span class="line">        id=?</span><br><span class="line">    `</span><br><span class="line">    const statement = db.prepare(sqlUpdate)</span><br><span class="line">    statement.run(email, user_id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建一个数据库</span><br><span class="line">const database = () =&gt; &#123;</span><br><span class="line">    const dbPath = &apos;web&apos;</span><br><span class="line">    const db = new Database(dbPath)</span><br><span class="line"></span><br><span class="line">    console.log(db.open, db.name)</span><br><span class="line"></span><br><span class="line">    // create(db)</span><br><span class="line">    // del(db, user_id)</span><br><span class="line">    // update(db, user_id, email)</span><br><span class="line">    // select(db,)</span><br><span class="line"></span><br><span class="line">    // 用完数据库需要关闭</span><br><span class="line">    db.close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="mongoDB"><a href="#mongoDB" class="headerlink" title="mongoDB"></a>mongoDB</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/21/node7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="eddy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="node">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/21/node7/" itemprop="url">node7</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-21T20:38:27-08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h1><ul>
<li>子类覆盖父类方法但是又要调用父类的方法: super.create()</li>
<li>session 的 cookie 加上 path 字段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意Path 的 P 是大写</span><br><span class="line">headers[&apos;Set-Cookies&apos;] = `session=$&#123;s&#125;; Path=/`</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="摘要-hash-—摘要不是加密"><a href="#摘要-hash-—摘要不是加密" class="headerlink" title="摘要 hash —摘要不是加密"></a>摘要 hash —摘要不是加密</h1><ul>
<li><p>摘要算法<br>摘要算法是一种能产生特殊输出格式的算法。给定任意长度的数据生成定长的密文.<br><strong>摘要结果是不可逆的, 不能被还原为原数据.</strong><br>理论上无法通过反向运算取得原数据， 而且一个安全的摘要无法找到碰撞.</p>
</li>
<li><p>作用:</p>
<ul>
<li>数据完整性验证, 下载的文件比对 sha1 的摘要结果， 就可以知道文件是否被篡改</li>
<li>保护用户密码， 防止撞库， 用 A 网站的密码到 B 网站测试登录</li>
</ul>
</li>
<li><p>常用的算法 md5 (32 字符) 和 sha1 (40 字符), sha256</p>
</li>
<li><p>问题: 彩虹表, 穷举各种组合的摘要.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const testMd5 = function(s) &#123;</span><br><span class="line">    // 改成 sha1 只要把 algorithm 改为 &apos;sha1&apos;就好了, 或者 &apos;sha256&apos;</span><br><span class="line">    const algorithm = &apos;md5&apos;</span><br><span class="line">    const hash = crypto.createHash(algorithm)</span><br><span class="line">    hash.update(s)</span><br><span class="line">    console.log(&apos;md5 摘要&apos;, hash.digest(&apos;hex&apos;))</span><br><span class="line">    return hash.digest(&apos;hex&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="加盐"><a href="#加盐" class="headerlink" title="加盐"></a>加盐</h1><p>盐（salt）是为了防止黑客对密码进行碰撞，假如用户使用简单密码, 破解者可以用提前生成的简单密码摘要表（彩虹表）来破解原文。所以我们会存储一个额外的信息，扰乱用户的简单密码。<br>加盐是在用户密码的基础上再加一些字符串， 然后再用摘要</p>
<ul>
<li>作用 : 让黑客拿到的数据是无意义的，让彩虹表无效.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function saltedPassword(password, salt=&apos;&apos;) &#123;</span><br><span class="line">    const _md5hex = (s) =&gt; &#123;</span><br><span class="line">        const hash = crypto.createHash(&apos;md5&apos;)</span><br><span class="line">        hash.update(s)</span><br><span class="line">        const h = hash.digest(&apos;hex&apos;)</span><br><span class="line">        return h</span><br><span class="line">    &#125;</span><br><span class="line">    // 把 password 加上一个字符串之后再摘要</span><br><span class="line">    const hash2 = _md5hex(password + salt)</span><br><span class="line">    return hash2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="重置密码的功能"><a href="#重置密码的功能" class="headerlink" title="重置密码的功能"></a>重置密码的功能</h1><p>用户点击忘记密码,  给客户邮箱发一个 url, 并且在 query 加一串随机字符 (自己设置伪随机字符串，比如 uuid,<br>不能是有规律的值, 比如用unix 时间)<br>客户点击之后, 发送 get 请求, 判断是否 expire (发送的时间, 过期时间和现在时间对比)<br>如果ok, 就跳到重置密码页面</p>
<h1 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h1><p>数据传输过程的任何环节, 层层路由器都可能被拦截和窃取. 用明文传输密码是绝对不安全的, 这就需要 https<br>https 是发数据的时候把页面所有的传输内容都加密了<br>https 的原理, 是非对称性加密, 把 http 的数据加密之后在浏览器和服务器之间传输.</p>
<ul>
<li><p><strong>非对称性加密加密算法:</strong><br>rsa, 每个人都有一对公钥和私钥<br>发数据的时候, 浏览器先用服务器的公钥加密, 公钥加密的数据只有私钥能解开, 所以服务器可以用自己的私钥解密, 服务器解密之后就可以拿到原始的 http 请求, 然后解析请求做响应. 其他任何人都无法不到原始信息.<br>服务器把浏览器的公钥拿过来, 加密响应之后再发给浏览器, 只有浏览器的私钥才能解开.</p>
</li>
<li><p>中间人攻击: 服务器发给服务器的请求被拦截, 导致请求并没有发送到服务器, 而是被中间拦截的人伪造服务器返回了, 而用 https 就可以避免这个情况, 因为中间人无法得到原始数据.</p>
</li>
<li><p>证书: 浏览器和服务器都由证书信任机构来保证 https 的进行. 解决通信之间的信任问题, 由权威机构颁发证书确认这个 url 确实属于这个公司.</p>
</li>
<li><p>对称性加密比较出名的是 aes<br>加密的秘钥和解密的秘钥用的是同一个, 用于 session， 需要知道原来的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1. 加密</span><br><span class="line">// aes-256-cbc 的加密和解密时间都比较短, 是表现比较不错的算法</span><br><span class="line"></span><br><span class="line">const Encrypt = function(s, key) &#123;</span><br><span class="line">    const algorithm = &apos;aes-256-cbc&apos;</span><br><span class="line">    // 秘钥是 key, 通过秘钥加密</span><br><span class="line">    const cipher = crypto.createCipher(algorithm, key)</span><br><span class="line">    let c = cipher.update(s, &apos;utf8&apos;, &apos;hex&apos;)</span><br><span class="line">    c += cipher.final(&apos;hex&apos;)</span><br><span class="line">    console.log(&apos;加密后的信息&apos;, c)</span><br><span class="line">    return c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2. 解密</span><br><span class="line">const Decrypt = function(c, key) &#123;</span><br><span class="line">    const algorithm = &apos;aes-256-cbc&apos;</span><br><span class="line">    const decipher = crypto.createDecipher(algorithm, key)</span><br><span class="line">    // 一定要用这种累加的方式来处理</span><br><span class="line">    // 这里需要注意的是调用 update 函数之后, 返回不一定是加密后的数据</span><br><span class="line">    // 所以要先调用 update, 然后调用 final, 并且把这些结果累加起来</span><br><span class="line">    let d = decipher.update(c, &apos;hex&apos;, &apos;utf8&apos;)</span><br><span class="line">    d += decipher.final(&apos;utf8&apos;)</span><br><span class="line">    console.log(&apos;原始信息&apos;, d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="微博评论功能"><a href="#微博评论功能" class="headerlink" title="微博评论功能"></a>微博评论功能</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">eddy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">eddy</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
